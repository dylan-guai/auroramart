{% extends "admin_panel/base.html" %}

{% block title %}Delete {{ product.name }} | AuroraMart Admin{% endblock %}

{% block page_title %}Delete Product{% endblock %}

{% block breadcrumbs %}
<nav class="text-sm breadcrumbs">
    <ul>
        <li><a href="{% url 'admin_panel:dashboard' %}">Dashboard</a></li>
        <li><a href="{% url 'admin_panel:product_list' %}">Products</a></li>
        <li><a href="{% url 'admin_panel:product_detail' product.id %}">{{ product.name }}</a></li>
        <li>Delete</li>
    </ul>
</nav>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="card bg-white shadow-lg">
        <div class="card-header">
            <h3 class="card-title text-red-600">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                Delete Product: {{ product.name }}
            </h3>
        </div>
        <div class="card-body">
            <!-- Product Info -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div class="flex items-center space-x-4">
                    {% if product.images.first %}
                        <div class="avatar">
                            <div class="w-16 h-16 rounded">
                                <img src="{{ product.images.first.image.url }}" alt="{{ product.name }}">
                            </div>
                        </div>
                    {% endif %}
                    <div>
                        <h4 class="font-bold text-lg">{{ product.name }}</h4>
                        <p class="text-gray-600">{{ product.sku }}</p>
                        <div class="flex space-x-4 mt-2">
                            <span class="badge badge-outline">{{ product.category.name }}</span>
                            <span class="badge badge-outline">{{ product.brand.name }}</span>
                            <span class="badge badge-outline">${{ product.price }}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Warning Message -->
            <div class="alert alert-warning mb-6">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <h3 class="font-bold">Warning!</h3>
                    <div class="text-sm">
                        <p>Are you sure you want to deactivate this product? This will remove it from the public catalog.</p>
                        <p class="mt-2"><strong>This will:</strong></p>
                        <ul class="list-disc list-inside mt-1">
                            <li>Remove the product from the public catalog</li>
                            <li>Hide the product from search results</li>
                            <li>Prevent new orders for this product</li>
                            <li>Keep existing order history intact</li>
                        </ul>
                        <p class="mt-2 text-blue-600"><strong>Note:</strong> This is a soft delete. The product can be reactivated later.</p>
                    </div>
                </div>
            </div>
            
            <!-- Product Statistics -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 rounded-lg p-4">
                    <h5 class="font-semibold text-blue-800">Stock Quantity</h5>
                    <p class="text-2xl font-bold text-blue-900">{{ product.stock_quantity }}</p>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <h5 class="font-semibold text-green-800">Orders</h5>
                    <p class="text-2xl font-bold text-green-900">{{ product.order_items.count }}</p>
                </div>
            </div>
            
            <!-- Delete Form -->
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <div class="form-control">
                    <label class="label" for="confirm_name">
                        <span class="label-text font-medium">Type the product name to confirm deletion</span>
                    </label>
                    <input type="text" name="confirm_name" id="confirm_name" 
                           class="input input-bordered w-full" 
                           placeholder="Enter product name to confirm"
                           required>
                </div>
                
                <div class="form-control">
                    <label class="label" for="reason">
                        <span class="label-text font-medium">Reason for deletion</span>
                    </label>
                    <textarea name="reason" id="reason" rows="3" 
                              class="textarea textarea-bordered" 
                              placeholder="Enter the reason for deleting this product (optional)"></textarea>
                </div>
                
                <!-- Actions -->
                <div class="flex justify-end space-x-4">
                    <a href="{% url 'admin_panel:product_detail' product.id %}" class="btn btn-outline">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-warning" id="delete-btn" disabled>
                        <i class="fas fa-ban mr-2"></i>
                        Deactivate Product
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmInput = document.getElementById('confirm_name');
    const deleteBtn = document.getElementById('delete-btn');
    const productName = '{{ product.name|escapejs }}';
    
    confirmInput.addEventListener('input', function() {
        if (this.value === productName) {
            deleteBtn.disabled = false;
            deleteBtn.classList.remove('btn-disabled');
        } else {
            deleteBtn.disabled = true;
            deleteBtn.classList.add('btn-disabled');
        }
    });
    
    // Add confirmation dialog
    deleteBtn.addEventListener('click', function(e) {
        if (!confirm('Are you absolutely sure you want to delete this product? This action cannot be undone.')) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}
